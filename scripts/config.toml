# Configuration for the tSZ mass bin analysis script.

# --- Paths ---
# Base directory used to resolve relative paths in this config.
[paths]
root = "/Users/rstiskalek/Projects/CMBOlympics"
# root = "/mnt/extraspace/rstiskalek/CMBOlympics"

# --- Runtime ---
# Global parallelism controls placed near the top for quick access.
[runtime]
n_jobs = 4

# --- Input Maps ---
# Paths to the HEALPix maps for the tSZ signal and random pointings.
[input_map]
signal_map = "data/COM_CompMap_Compton-SZMap-nilc-ymaps_2048_R2.00.fits"
random_pointing = "data/COM_CompMap_Compton-SZMap-nilc-ymaps_2048_R2.00_RAND_POINTING.hdf5"
# FWHM in arcminutes for smoothing the input map.
smooth_fwhm = 9.6

# --- Random Profile Generation Defaults ---
# Default parameters for generate_random_tsz_profiles.py. These control the
# sampling scheme for the random pointing pool. The Planck map path and the
# output HDF5 are taken from [input_map].
[random_profiles]
# Signal aperture radii configuration (arcmin).
theta_min = 1.0
theta_max = 751.0
n_theta = 1001
# Random pointing sampling controls.
n_points = 100_000
abs_b_min = 10.0
fwhm_arcmin = 9.6
seed = 42

# --- Halo Selection Cuts ---
# Criteria for filtering halos from the catalogue before analysis.
[halo_cuts]
r_min = 0.0       # Minimum comoving distance [Mpc/h]
r_max = 150.0     # Maximum comoving distance [Mpc/h]
b_min = 10.0      # Minimum Galactic latitude (absolute value) [degrees]
mass_min = 1e14   # Minimum halo mass (M_200c) [M_sun/h]
mass_max = 1e16   # Maximum halo mass (M_200c) [M_sun/h]
theta_min = 5.0   # Minimum angular size (theta_500) [arcmin]
theta_max = 6000  # Maximum angular size (theta_500) [arcmin]

# --- Mass Binning ---
# Parameters for dividing the selected halos into mass bins.
[mass_bins]
mass_step = 0.2   # Width of mass bins in log10(M_sun/h)
top_counts = [10, 50, 100] # Special high-mass bins containing the top N halos
verbose_bins = true # Print details about the created mass bins

# --- Analysis Parameters ---
# Settings for the main analysis pipeline.
[analysis]
which_simulation = "csiborg2" # Key for the halo catalogue to use (see below)
output_folder = "results" # Folder to save the HDF5 output file
# output_tag = ""             # Optional tag to append to the output filename

# Aperture and profile settings
aperture_scale = 2.0          # Aperture size for per-halo p-value, as a multiple of theta_500

# Stacked profile settings
stack_rmin = 0.1  # Minimum radius for stacked profiles (in units of aperture scale)
stack_rmax = 2.0  # Maximum radius for stacked profiles (in units of aperture scale)
stack_n = 501     # Number of radial bins for stacked profiles

# 2D cutout settings
cutout_random_samples = 0    # Number of random cutouts to stack for comparison (0 to disable)
cutout_max_bins = 3          # Only generate cutouts for the first N mass bins
cutout_pixels = 301          # Number of pixels per side for each 2D cutout
cutout_nbins = 256           # Number of bins for the normalized 2D cutout grid
cutout_size_scale = 5        # Cutout size as a multiple of theta_500
cutout_random_abs_b_min = 10 # Minimum Galactic latitude for random cutouts

# Stacking and significance settings
bootstrap = 10_000           # Number of bootstrap resamples for error estimation
high_sample_bins = 3         # Number of high-mass bins to use more random samples for
random_pool_samples_high = 10000 # Number of random stacks for high-mass bins
random_pool_samples_low = 1000   # Number of random stacks for low-mass bins
t_fit_nth_sample = 10        # Down-sampling factor for t-distribution fitting (1 for full)

# General settings
seed = 42   # Random seed for reproducibility

# Output data control
return_individual_profiles = false # Save all individual 1D profiles to the output file
return_random_profiles = false     # Save all individual random 1D profiles to the output file

# --- Halo Catalogues ---
# Definitions of available halo catalogues. The key is used in `analysis.which_simulation`.
[halo_catalogues]

[halo_catalogues.csiborg1]
fname = "data/csiborg1_fof.hdf5"
nsim = 7540
box_size = 677.7
omega_m = 0.307
position_key = "Position"
mass_key = "M200c"
radius_key = "R500c"

[halo_catalogues.csiborg2]
fname = "data/csiborg2_fof.hdf5"
nsim = 16417 # Which simulation number to process ("all" or a specific integer)
position_key = "Coordinates"
mass_key = "Group_M_Crit200"
radius_key = "Group_R_Crit500"
box_size = 676.6
omega_m = 0.3111


[halo_catalogues.manticore]
fname = "data/manticore_fof.hdf5"
nsim = 16417 # Which simulation number to process ("all" or a specific integer)
position_key = "Coordinates"
mass_key = "Group_M_Crit200"
radius_key = "Group_R_Crit500"
box_size = 681.0
omega_m = 0.306